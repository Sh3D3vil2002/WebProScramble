<!-- DayJaney Pringle - 2200367
     Jade Wilson      - 1506811
     Worrell Seville  - 1800577  
     Lamar Haye       - 2111690    -->
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="style.css">

	<title>Scramble</title>
</head>

<body>
	<div class="container">
		<form id="form" class="login-email" style="display: block">
			<p class="login-text" style="font-size: 2rem; font-weight: 800;">Register</p>
			<div class="input-group">
				<input type="text" placeholder="First Name" id="fname" name="fname" required>
			</div>
			<div class="input-group">
				<input type="text" placeholder="Last Name" id="lname" name="lname" required>
			</div>
			<div class="input-group">
				<input type="email" placeholder="Email" id="email" required>
			</div>
			<div class="input-group">
				<input type="Date" placeholder="Date Of Birth" id="dob" required>
			</div>
			<div class="input-group">
				<input type="text" placeholder="Age" id="age" disabled>
			</div>
			<div class="input-group">
				<select class="input-group" id="gender" name="gender" required>
					<option value="other">Select A Gender</option>
					<option value="male">Male</option>
					<option value="female">Female</option>
				</select>
			</div>
			<div class="input-group">
				<button type="submit" name="submit" class="btn" id="register-btn" onclick="register()">Register</button>
			</div>
			<div class="input-group">
				<button type="button" name="start" class="btn" id="start-btn" onclick="PlayGame()"
					disabled>Start</button>
			</div>
			<div class="input-group">
				<button type="button" name="end" class="btn" id="end-btn" onclick=" findPercentageScore()"
					disabled>End</button>
			</div>
		</form>
		<div>
			<form>
				<h6>Percentage:</h6>
				<textarea id="showpercentage" rows="4" cols="50" disabled></textarea>
			</form>
		</div>
		<div class="play-area" id="play-area" style="display: none;">
			<p class="login-text" style="font-size: 2rem; font-weight: 800;">Scramble Game</p>
			<center>
				<p style="margin-bottom: 5px;" class="score">Score</p>
				<input style="margin-bottom: 10px;" type="number" class="score" id="score" value="0" disabled></p>

				<div class="input-group" style="margin-bottom: 10px;">
					<p>Scrambled Word</p>
					<input type="text" id="random" name="random" disabled>
				</div>
				<div class="input-group" style="margin-bottom: 5px;">
					<input type="text" placeholder="Enter Your Answer" id="answer-input" name="answer" required
						disabled>
				</div>
				<div class="input-group">
					<button type="button" name="accept" id="accept-btn" class="btn" onclick="CheckAnswer()"
						disabled>Accept</button>

					<button type="button" name="next" class="btn" id="next-btn" onclick="PlayGame()"
						disabled>Next</button>
				</div>
				<div class="input-group">
					<p id="chars" style="font-size: 2rem; font-weight: 800;"></p>
				</div>
			</center>
		</div>
	</div>
</body>
<script>
	// Define global variables
	var PlayersData = [];
	var gameCharacters = [];
	var answerInput = document.getElementById("answer-input");
	var acceptBtn = document.getElementById("accept-btn");
	var nextBtn = document.getElementById("next-btn");

	// Disable game controls
	answerInput.disabled = true;
	acceptBtn.disabled = true;
	nextBtn.disabled = true;
	var randomString;
	var count = 0;
	var quest = 0;


	function register() {
		// Disable all form fields and the register button
		document.querySelectorAll(".input-group input, .input-group select, .input-group button").forEach(function (el) {
			el.disabled = true;
		});

		// Enable the "End" and "Start" buttons
		document.querySelector("#end-btn").disabled = false;
		document.querySelector("#start-btn").disabled = false;
		//Validate the name
		var fname = document.getElementById("fname").value;
		var lname = document.getElementById("lname").value;
		var email = document.getElementById("email").value;
		// Check if first and last name are at least 3 characters long
		if (fname.length < 3 || lname.length < 3) {
			alert("First and Last Names must be more than three (3) characters in length.");
			return false;
		}

		// Validate email
		var emailRegex = /^[a-zA-Z0-9._-]+@gmail\.com$/;
		if (!emailRegex.test(email)) {
			alert("Email address must be a valid Gmail address.");
			return false;
		}

		//Validate age
		// Get the user's date of birth from the input field
		var dob = new Date(document.getElementById("dob").value);

		// Calculate the user's age based on their date of birth
		var ageDiffMs = Date.now() - dob.getTime();
		var ageDate = new Date(ageDiffMs);
		var age = Math.abs(ageDate.getUTCFullYear() - 1970);

		// Display the user's age on the page
		var ageEl = document.getElementById("age");
		ageEl.value = age;

		// Check if the user is at least 18 years old
		if (age >= 8 && age <= 12) {
			ageEl.style.color = "green";
		} else {
			ageEl.style.color = "red";
			ageEl.value += " (between 8 and 12 years old)";
		}

		// Add the player's data to the PlayersData array
		PlayersData.push({
			firstName: fname,
			lastName: lname,
			email: email,
			dob: dob,
			age: age,
			gender: document.getElementById("gender").value
		});

		return false;
	}

	function PlayGame() {
		document.getElementById("showpercentage").value = "";

		quest = quest + 1;
		// Generate a random string of characters
		var characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
		var numCharacters = Math.floor(Math.random() * 3) + 4;
		randomString = "";
		for (var i = 0; i < numCharacters; i++) {
			randomString = randomString + characters.charAt(Math.floor(Math.random() * characters.length));
		}
		console.log("ANSWER: " + randomString);

		var shuffle = '';
		var rString = randomString.split('');
		while (rString.length > 0) {
			shuffle += rString.splice(rString.length * Math.random() << 0, 1);
		}

		//Disable the form
		// var form = document.getElementById("form");
		// if (form.style.display === 'block') {
		// 	form.style.display = 'none';
		// }

		//Display play area
		var playArea = document.getElementById("play-area");
		if (playArea.style.display === 'none') {
			playArea.style.display = 'block';
		}
		// Display the random string in the play area
		document.getElementById("random").value = shuffle;

		// Enable the answer input, accept button, and next button
		document.getElementById("answer-input").disabled = false;
		document.getElementById("accept-btn").disabled = false;
		document.getElementById("next-btn").disabled = false;

		// Clear the answer input field
		document.getElementById("answer-input").value = "";

		// Set focus to the answer input field
		document.getElementById("answer-input").focus();
	}

	function CheckAnswer() {
		console.log("Answer to be checked: " + randomString.toLowerCase());
		// get the player's answer
		var answer = document.getElementById("answer-input").value.trim();

		// validate the answer
		if (answer == "") {
			alert("Please enter your answer.");
			return;
		}

		// check if the answer is correct
		var isCorrect = (answer.toLowerCase() == randomString.toLowerCase());
		console.log("Correct: " + isCorrect);

		if (isCorrect.valueOf(true)) {
			console.log("In if statement, Validate answer");
			// update the score
			var scoreElem = document.getElementById("score");
			if (isCorrect) {
				console.log("In if to update score");
				scoreElem.value = parseInt(scoreElem.value) + 1;
				count = count + 1;
			}

			// append the result to the PlayersData array
			var playerData = {
				originalChars: randomString,
				answer: answer,
				count: count,
				isCorrect: isCorrect
			};
			PlayersData.push(playerData);

			// disable the answer input and Accept button, and enable the Next button
			document.getElementById("answer-input").disabled = true;
			document.getElementById("accept-btn").disabled = true;
			document.getElementById("next-btn").disabled = false;
		}


	}

	// Get the form element
	var form = document.querySelector('.login-email');

	// Add an event listener for the form submission
	form.addEventListener('submit', function (event) {
		// Prevent the default form submission behavior
		event.preventDefault();

		// Call the register function
		register();
	});

	let currentDate = new Date();

	function findPercentageScore() {
		let percentageScore = (count / quest) * 100;
		let displayText = `Player: ${PlayersData[0].firstName + ' ' + PlayersData[0].lastName}\n`;
		displayText += `Date: ${currentDate}\n`;
		displayText += `Total Questions: ${quest}\n`;
		displayText += `Correct Answers: ${count}\n`;
		displayText += `Percentage Score: ${percentageScore.toFixed(2)}%\n`;
		document.getElementById('showpercentage').value = displayText;

		//clearform 
		clearForm();

		//enable fields
		document.getElementById("fname").disabled = false;
		document.getElementById("lname").disabled = false;
		document.getElementById("email").disabled = false;
		document.getElementById("dob").disabled = false;
		document.getElementById("gender").disabled = false;

		// reset play area 
		resetPlayArea();

		//disable playarea
		var playArea = document.getElementById("play-area");
		if (playArea.style.display === 'block') {
			playArea.style.display = 'none';
		}

		//disable buttons except register
		document.querySelector("#register-btn").disabled = false;
		document.querySelector("#end-btn").disabled = true;
		document.querySelector("#start-btn").disabled = true;

		//reset values
		count = 0;
		quest = 0;

		document.getElementById("fname").focus;

	}

	function clearForm() {
		document.getElementById("form").reset(); // reset the form to clear any error messages
		document.getElementById("fname").value = ""; // set the value of each input element to an empty string
		document.getElementById("lname").value = "";
		document.getElementById("email").value = "";
		document.getElementById("dob").value = "";
		document.getElementById("age").value = "";
		document.getElementById("gender").selectedIndex = 0; // reset the dropdown to the default option
	}

	function resetPlayArea() {
		document.getElementById("score").value = 0;
		document.getElementById("random").value = "";
		document.getElementById("answer-input").value = "";
		document.getElementById("chars").textContent = "";
	}


</script>

</html>